<!--메인 홈-->
{% extends 'base_index.html' %}
{% load staticfiles %}
{% block content %}

<body>
<!-- 카드는 나중에 다시 넣어보자 -->
{% if schedule.count == 0 %}
<section class="price_table_area" id="price" style="margin: 0px;">
    <div class="container">
        <center><h2> 수강중인 강의가 없어요 ㅠ_ㅠ<br>시간표를 추가해주세요!<h2></center>
        <div class="app_round_image">
            <img class="round_c" src="{% static 'image/index/round-circle.png' %}" alt="">
            <a href="{% url 'main:mypage' user.username %}" class="app_mobile">
            <h4 style="font-family: 'BRRA_R';
    font-weight: 500;
    line-height: 1.1;
    color: inherit;"> 추가하기 </h4></a>
            
        </div>          
    </div>
</section>
{% else %}
        <section class="price_table_area" id="price">
			<div class = "container" style = "position: relative; width: 300px; height: 200px; font-family:'BRRA_R' !important">
            <center>
					<form action="{% url 'main:filter' %}" method="POST">
					{% csrf_token %}
						<input type="submit" name="action" value="모두" class="transparent-input">
						<input type="submit" name="action" value="월" class="transparent-input">
						<input type="submit" name="action" value="화" class="transparent-input">
						<input type="submit" name="action" value="수" class="transparent-input">
						<input type="submit" name="action" value="목" class="transparent-input">
						<input type="submit" name="action" value="금" class="transparent-input">
						<a style = "color:#6e6b6b" href="{% url 'main:upload' user%}">추가하기</a>
					</form>
					<div class="main_title">
                    	<h2>대리프린트 목록</h2>
					</div>
            </center>
			</div>	
            <div class="container">
                <div class="price_table_inner">
                	{% for item in prints %}
                    <div class="price_item">
                        <div class="price_header">
                            <h6>{{item.uploader}} </h6>
                            <h2>{{item.schedule.lecture.name}}</h2>
                            <h3 id="detail_price">{{item.print_price}}+?</h3>
                           <!--  <h6>{{item.id}}</h6> -->
                        </div>
                        <ul>
                            <div class="time-elapsed"></div>
                            <li class="date"><a href="#">{{ item.date|date:'Y-m-d H:i:s' }}</a></li>
                            <form action="{% url 'main:endtimer' %}" method='POST' class="f" id="f">
                            {% csrf_token %}
                            <div id="print_id" value="{{item.id}}"></div>
                            <div id="class"></div>
                            </form>
                        </ul>
                        <a class="price_btn" href ="{% url 'main:detail' item.id %}" style="font-family:'BRRA_R' !important;">상세보기</a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        
        {% endif %}
</section>
    </body>

<script type="text/javascript">
	var getDate = document.getElementsByClassName("date");
	var startDateTime = new Array();
	var startStamp = new Array();
	//print(getDate)
	for (var i = 0; i < getDate.length; i++) {
    	// getDate[i].innerHTML = getDate[i].textContent;
	    startDateTime[i] = new Date(getDate[i].textContent)
	    startStamp[i] = startDateTime[i].getTime();
    	// startStamp = getDate[i].textContent.getTime();
	}
	// var startDateTime = new Date(2019,7,10,2,1,0,0); // YYYY (M-1) D H m s (start time and date from DB)
	// var startStamp = startDateTime.getTime();

	var newDate = new Date();
	var newStamp = newDate.getTime();

	var timer;
	var cnt = getDate.length;
	// var self = this;

	function updateClock() {
	    newDate = new Date();
	    newStamp = newDate.getTime();
	    var diff = new Array();
	    var d = new Array();
	    var h = new Array();
	    var m = new Array();
	    var s = new Array();

		for (var i = 0; i < cnt ; i++) {
	    	diff[i] = Math.round((startStamp[i]-newStamp)/1000);
	    	d[i] = Math.floor(diff[i]/(24*60*60));
		    diff[i] = diff[i]-(d[i]*24*60*60);
		    h[i] = Math.floor(diff[i]/(60*60));
		    diff[i] = diff[i]-(h[i]*60*60);
		    m[i] = Math.floor(diff[i]/(60));
		    diff[i] = diff[i]-(m[i]*60);
		    s[i] = diff[i];
		}

		var elements = document.getElementsByClassName("time-elapsed");
		var header = document.getElementsByClassName("price_header");
		var btn = document.getElementsByClassName("price_btn");

    	for (var i = 0; i < cnt; i++) {
    		if(d[i]>=0)
        		elements[i].innerHTML = d[i]+" 일 "+h[i]+" 시간 "+m[i]+" 분 "+s[i]+" 초";
        	else{
        		elements[i].innerHTML = "--";
        		// header[i].style.backgroundColor = "gray"
        		// btn[i].style.backgroundColor = "gray"
        		// btn[i].style.visibility = "hidden"

        		var pid = document.getElementById("print_id").value;
        		var pid = $('#print_id').attr("value");

        		$('#class').html("<input name = 'valid' id = 'valid' value= "+pid+">")

        		document.forms["f"].submit();
        		break;
        	}
        	// header[i].style.backgroundColor = "gray"
   		}

	}

	setInterval(updateClock, 1000);

</script>
<style>
    input.transparent-input{
       background-color:transparent !important;
       border:none !important;
       box-shadow:none !important;
    }
</style>
    {% endblock %}
